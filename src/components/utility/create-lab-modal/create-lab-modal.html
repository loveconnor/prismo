<app-dialog
  [open]="open"
  (openChange)="openChange.emit($event)"
  [className]="dialogClasses"
  [closeOnBackdropClick]="true"
>
  <form (submit)="submit($event)">
    <app-dialog-header [className]="'space-y-0'">
      <div class="modal-header">
        <div class="icon-pill">
          <ng-icon name="lucide-sparkles" class="h-5 w-5"></ng-icon>
        </div>
        <div class="flex-1">
          <app-dialog-title [className]="titleClasses">Generate a New Lab</app-dialog-title>
          <app-dialog-description [className]="descriptionClasses">
            Customize your learning experience by selecting a subject, difficulty, and focus areas.
          </app-dialog-description>
        </div>
      </div>
    </app-dialog-header>

    <div class="modal-body">
      <div class="field-group">
        <app-label for="subject" [className]="labelClasses">
          Choose a subject <span class="required">*</span>
        </app-label>
        <app-select
          id="subject"
          name="subject"
          [options]="subjects"
          [className]="selectTriggerClasses"
          [contentClassName]="selectContentClasses"
          [optionClassName]="selectOptionClasses"
          [placeholder]="'Select subject…'"
          [(ngModel)]="subject"
        ></app-select>
      </div>

      <div class="field-group">
        <app-label for="difficulty" [className]="labelClasses">
          Select difficulty <span class="required">*</span>
        </app-label>
        <app-select
          id="difficulty"
          name="difficulty"
          [options]="difficulties"
          [className]="selectTriggerClasses"
          [contentClassName]="selectContentClasses"
          [optionClassName]="selectOptionClasses"
          [placeholder]="'Choose difficulty…'"
          [(ngModel)]="difficulty"
        ></app-select>
      </div>

      <div class="field-group">
        <app-label for="skills" [className]="labelClasses">
          What skills do you want to practice?
        </app-label>
        <app-input
          id="skills"
          name="skills"
          [ngModel]="skillInput"
          (ngModelChange)="onSkillInputChange($event)"
          (keydown)="handleSkillKeydown($event)"
          placeholder="Add skills (e.g., loops, debugging, recursion)"
          [className]="inputClasses"
        ></app-input>

        @if (skills.length > 0) {
          <div class="skills-list">
            @for (skill of skills; track i; let i = $index) {
              <span class="skill-pill">
                {{ skill }}
                <button type="button" (click)="removeSkill(i)">
                  <ng-icon name="lucide-x" class="h-3 w-3"></ng-icon>
                </button>
              </span>
            }
          </div>
        }

        <p class="helper-text">Optional — helps the AI personalize your lab</p>
      </div>

      <div class="field-group">
        <app-label for="goal" [className]="labelClasses">
          Describe your focus area (optional)
        </app-label>
        <app-textarea
          id="goal"
          name="goal"
          [ngModel]="goal"
          (ngModelChange)="onGoalChange($event)"
          placeholder="e.g., I want to get better at debugging for-loops"
          [rows]="3"
          [className]="textareaClasses"
        ></app-textarea>
      </div>
    </div>

    <app-dialog-footer class="footer">
      <app-button 
        type="submit" 
        [disabled]="!canSubmit" 
        [className]="buttonClasses"
      >
        <ng-icon name="lucide-sparkles" class="h-4 w-4"></ng-icon>
        Generate Lab
      </app-button>
    </app-dialog-footer>
  </form>
</app-dialog>
