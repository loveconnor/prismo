<!-- Pill Variant -->
<div
  *ngIf="variant === 'pill'"
  role="timer"
  [attr.aria-label]="a11yLabel || (mode === 'countdown' ? 'Time remaining' : 'Time elapsed') + ': ' + formattedTime()"
  [class]="cn(
    'inline-flex items-center gap-2 rounded-full border px-3 py-1.5 text-sm',
    'border-[#1f2937] bg-[#0e1318] text-[#e5e7eb]',
    size === 'sm' && 'px-2 py-1 text-xs',
    size === 'lg' && 'px-4 py-2 text-base'
  )"
>
  <ng-icon name="lucideClock" [class]="'h-4 w-4 ' + stateDisplay().color"></ng-icon>
  <span class="font-mono tabular-nums">
    {{ formattedTime() }}
  </span>
  <ng-icon 
    *ngIf="timerState() === 'expired'"
    name="lucideTriangleAlert" 
    class="h-4 w-4 text-red-500"
  ></ng-icon>
</div>

<!-- Card/Inline Variant -->
<div
  *ngIf="variant !== 'pill'"
  role="timer"
  [attr.aria-label]="a11yLabel || (mode === 'countdown' ? 'Countdown timer' : 'Stopwatch')"
  [class]="cn(
    'mx-auto w-full max-w-md rounded-2xl border border-[#1f2937] bg-[#0e1318] shadow-sm',
    variant === 'inline' && 'max-w-full',
    size === 'sm' && 'p-3',
    size === 'md' && 'p-4',
    size === 'lg' && 'p-6'
  )"
>
  <!-- Header -->
  <div class="mb-3 flex items-center justify-between gap-2">
    <div class="flex items-center gap-2">
      <ng-icon name="lucideClock" class="h-5 w-5 text-[#bc78f9]"></ng-icon>
      <h3 class="text-sm font-medium text-[#e5e7eb]">
        {{ mode === 'countdown' ? 'Time Remaining' : 'Time Elapsed' }}
      </h3>
      <span class="text-xs text-[#6b7280]">
        {{ getScopeLabel() }}
      </span>
    </div>
    <div [class]="'rounded-full border px-2 py-0.5 text-xs ' + getSeverityColor()">
      {{ stateDisplay().label }}
    </div>
  </div>

  <!-- Display -->
  <div class="mb-4">
    <div [class]="cn(
      'font-mono text-center tabular-nums',
      size === 'sm' && 'text-2xl',
      size === 'md' && 'text-3xl',
      size === 'lg' && 'text-4xl',
      getTimerDisplayColor()
    )">
      {{ formattedTime() }}
    </div>
    
    <div 
      *ngIf="showProgress && (durationMsRef > 0 || pacing?.targetMs)"
      class="mt-3 h-1.5 w-full overflow-hidden rounded-full bg-[#1f2937]"
    >
      <div
        [class]="'h-full rounded-full transition-all ' + getProgressBarColor()"
        [style.width.%]="Math.min(progressPercent(), 100)"
      ></div>
    </div>
  </div>

  <!-- Nudge Message -->
  <div 
    *ngIf="nudgeMessage()"
    class="mb-3 flex items-start gap-2 rounded-lg border border-amber-500/20 bg-amber-500/10 p-2 text-xs text-amber-500"
  >
    <ng-icon name="lucideInfo" class="h-4 w-4 flex-shrink-0"></ng-icon>
    <span>{{ nudgeMessage() }}</span>
  </div>

  <!-- Controls -->
  <div *ngIf="!hideControls" class="flex flex-wrap items-center justify-center gap-2">
    <!-- Start/Resume Button -->
    <button
      *ngIf="timerState() === 'idle' || timerState() === 'paused'"
      (click)="timerState() === 'idle' ? handleStart() : handleResume()"
      [disabled]="timerReadOnly"
      class="inline-flex items-center gap-2 rounded-lg bg-[#BC78F9] px-4 py-2 text-sm font-medium text-white transition-colors hover:bg-primary-custom disabled:cursor-not-allowed disabled:opacity-50"
      type="button"
    >
      <ng-icon name="lucidePlay" class="h-4 w-4"></ng-icon>
      {{ timerState() === 'idle' ? 'Start' : 'Resume' }}
      <kbd class="hidden rounded border border-white/20 px-1 py-0.5 text-xs sm:inline">Space</kbd>
    </button>

    <!-- Pause Button -->
    <button
      *ngIf="timerState() === 'running' && allowPause"
      (click)="handlePause()"
      [disabled]="timerReadOnly"
      class="inline-flex items-center gap-2 rounded-lg border border-[#1f2937] bg-[#0b0f14] px-4 py-2 text-sm text-[#e5e7eb] transition-colors hover:bg-[#0e1318] disabled:cursor-not-allowed disabled:opacity-50"
      type="button"
    >
      <ng-icon name="lucidePause" class="h-4 w-4"></ng-icon>
      Pause
      <kbd class="hidden rounded border border-[#1f2937] px-1 py-0.5 text-xs sm:inline">Space</kbd>
    </button>

    <!-- Reset Button -->
    <button
      *ngIf="allowReset && timerState() !== 'idle'"
      (click)="handleReset()"
      [disabled]="timerReadOnly"
      class="inline-flex items-center gap-2 rounded-lg border border-[#1f2937] bg-[#0b0f14] px-3 py-2 text-sm text-[#9ca3af] transition-colors hover:bg-[#0e1318] hover:text-[#e5e7eb] disabled:cursor-not-allowed disabled:opacity-50"
      type="button"
    >
      <ng-icon name="lucideRotateCcw" class="h-4 w-4"></ng-icon>
      Reset
      <kbd class="hidden rounded border border-[#1f2937] px-1 py-0.5 text-xs sm:inline">r</kbd>
    </button>

    <!-- Add Time Button -->
    <button
      *ngIf="allowAddTime && mode === 'countdown' && timerState() !== 'expired'"
      (click)="handleAddTime()"
      [disabled]="timerReadOnly"
      class="inline-flex items-center gap-2 rounded-lg border border-emerald-500/20 bg-emerald-500/10 px-3 py-2 text-sm text-emerald-500 transition-colors hover:bg-emerald-500/20 disabled:cursor-not-allowed disabled:opacity-50"
      type="button"
    >
      <ng-icon name="lucidePlus" class="h-4 w-4"></ng-icon>
      +{{ formatTime(addTimeIncrementMs, 'auto', false) }}
      <kbd class="hidden rounded border border-emerald-500/20 px-1 py-0.5 text-xs sm:inline">+</kbd>
    </button>

    <!-- Mute Button -->
    <button
      (click)="handleToggleMute()"
      class="inline-flex items-center gap-2 rounded-lg border border-[#1f2937] bg-[#0b0f14] px-3 py-2 text-sm text-[#9ca3af] transition-colors hover:bg-[#0e1318] hover:text-[#e5e7eb]"
      [attr.aria-label]="isMuted() ? 'Unmute alerts' : 'Mute alerts'"
      type="button"
    >
      <ng-icon 
        *ngIf="isMuted()"
        name="lucideVolumeX" 
        class="h-4 w-4"
      ></ng-icon>
      <ng-icon 
        *ngIf="!isMuted()"
        name="lucideVolume2" 
        class="h-4 w-4"
      ></ng-icon>
    </button>
  </div>

  <!-- Expired State -->
  <div 
    *ngIf="timerState() === 'expired'"
    class="mt-4 rounded-lg border border-red-500/20 bg-red-500/10 p-3 text-center text-sm text-red-500"
  >
    <ng-icon name="lucideTriangleAlert" class="mx-auto mb-1 h-5 w-5"></ng-icon>
    <p class="font-medium">Time's up!</p>
    <p *ngIf="autoSubmitOnExpire" class="mt-1 text-xs">Your work has been auto-submitted.</p>
  </div>
</div>

