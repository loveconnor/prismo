@if (!collapsed) {
  <aside class="flex w-full min-w-[280px] flex-col border-r border-[#1f2937] bg-[#0e1318] flex-shrink-0">
    <div class="flex items-center justify-between border-b border-[#1f2937] p-4">
      <h2 class="text-sm font-semibold text-[#e5e7eb]">Steps</h2>
      <app-button variant="ghost" size="icon" className="h-7 w-7 text-[#a9b1bb] hover:bg-white/[0.04] hover:text-[#e5e7eb]" (click)="onToggle()">
        <ng-icon name="lucideChevronLeft" class="h-4 w-4"></ng-icon>
      </app-button>
    </div>

    <div class="border-b border-[#1f2937] p-4">
      <div class="mb-2 flex justify-between text-xs text-[#9ca3af]">
        <span>Progress</span>
        <span>{{ progress | number:'1.0-0' }}%</span>
      </div>
      <app-progress [value]="progress" className="h-1.5"></app-progress>
    </div>

    <div class="flex-1 flex flex-col">
      <div class="p-4 space-y-2">
        <button
          *ngFor="let step of steps; trackBy: trackByStepId"
          type="button"
          (click)="onClickStep(step.id)"
          [attr.aria-disabled]="isLocked(step.id) ? true : null"
          [attr.title]="isLocked(step.id) ? 'Complete previous steps first' : null"
          [class]="'w-full flex items-center gap-3 p-3 rounded-lg border transition-all text-left ' +
                    (currentStep === step.id ? 'bg-[#1a1f26] border-[#2563eb]/30' : 'border-[#1f2937] hover:bg-[#12161b]') + ' ' +
                    (isLocked(step.id) ? 'opacity-50 cursor-not-allowed hover:bg-transparent' : '')">
          <div
            [class]="'flex items-center justify-center w-6 h-6 rounded-full border text-xs font-semibold shrink-0 ' +
                      (isCompleted(step.id) ? 'bg-[#16a34a] border-[#16a34a] text-white' :
                       (currentStep === step.id ? 'bg-[#2563eb] border-[#2563eb] text-white' : 'bg-[#151a20] border-[#1f2937] text-[#a9b1bb]'))">
            <ng-icon *ngIf="isCompleted(step.id)" name="lucideCheck" class="h-3 w-3"></ng-icon>
            <span *ngIf="!isCompleted(step.id)">{{ step.id }}</span>
          </div>
          <span class="text-sm font-medium text-[#e5e7eb]">{{ step.title }}</span>
        </button>
      </div>

      @if (currentStepData) {
        <div class="border-t border-[#1f2937] bg-[#0e1318] p-4 flex-1 overflow-y-auto">
          <div class="mb-3 flex items-center gap-2">
            <div class="flex h-6 w-6 items-center justify-center rounded-full bg-[#2563eb] text-white text-xs font-semibold">
              {{ currentStep }}
            </div>
            <h3 class="text-sm font-semibold text-[#e5e7eb]">Current Step Instructions</h3>
          </div>

          <div class="space-y-3">
            <h4 class="text-sm font-semibold text-[#e5e7eb]">{{ currentStepData.title }}</h4>
            <div *ngIf="currentStepData.instruction" class="prose prose-sm dark:prose-invert" [innerHTML]="currentStepData.instruction | safeHtml"></div>
            <div *ngIf="currentStepData.example" class="pl-3 border-l-2 border-[#16a34a]">
              <div class="prose prose-sm dark:prose-invert" [innerHTML]="toExampleHtml(currentStepData.example) | safeHtml"></div>
            </div>
          </div>
        </div>
      }
    </div>
  </aside>
}


