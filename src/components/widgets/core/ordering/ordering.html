<div
  role="group"
  [attr.aria-label]="a11yLabel || 'Ordering exercise: ' + (title || 'Arrange items')"
  [ngClass]="getContainerClasses()"
>
  <!-- Header -->
  <div class="mb-4">
    <h3 *ngIf="title" class="text-lg font-semibold text-[#e5e7eb]">{{ title }}</h3>
    <p class="text-sm text-[#9ca3af]">{{ instructions }}</p>
  </div>

  <!-- Controls -->
  <div class="mb-4 flex items-center justify-between">
    <div class="flex items-center gap-2">
      <button
        *ngIf="shuffleItems"
        (click)="handleShuffle()"
        [disabled]="state() === 'completed'"
        class="inline-flex items-center gap-2 rounded-lg border border-[#1f2937] bg-[#0b0f14] px-3 py-2 text-sm text-[#a9b1bb] hover:bg-[#0e1318] hover:text-[#e5e7eb] transition-colors disabled:cursor-not-allowed disabled:opacity-50"
      >
        <ng-icon name="lucideShuffle" class="h-4 w-4"></ng-icon>
        Shuffle
      </button>
      <button
        (click)="handleReset()"
        class="inline-flex items-center gap-2 rounded-lg border border-[#1f2937] bg-[#0b0f14] px-3 py-2 text-sm text-[#a9b1bb] hover:bg-[#0e1318] hover:text-[#e5e7eb] transition-colors"
      >
        Reset
      </button>
    </div>

    <button
      *ngIf="!autoCheck && state() !== 'completed'"
      (click)="handleCheckOrder()"
      class="inline-flex items-center gap-2 rounded-lg border border-[#60a5fa] bg-[#60a5fa]/10 px-4 py-2 text-sm text-[#60a5fa] hover:bg-[#60a5fa]/20 transition-colors"
    >
      Check Order
    </button>

    <div *ngIf="state() === 'completed'" class="text-sm text-[#9ca3af]">
      {{ correctCount() }} / {{ items.length }} correct
    </div>
  </div>

  <!-- Ordering Interface -->
  <div class="space-y-3">
    <div
      *ngFor="let item of orderedItems(); let index = index"
      [draggable]="mode === 'drag-drop' && state() !== 'completed'"
      (dragstart)="handleDragStart($event, index)"
      (dragover)="handleDragOver($event)"
      (drop)="handleDrop($event, index)"
      [ngClass]="getItemClasses(item, index)"
    >
      <!-- Drag Handle -->
      <div
        *ngIf="mode === 'drag-drop' && state() !== 'completed'"
        class="cursor-move text-[#6b7280] hover:text-[#e5e7eb]"
      >
        <ng-icon name="lucideGripVertical" class="h-5 w-5"></ng-icon>
      </div>

      <!-- Position Indicator -->
      <div *ngIf="showPositions" [ngClass]="getPositionClasses(item, index)">
        {{ index + 1 }}
      </div>

      <!-- Content -->
      <div class="flex-1">
        <div class="text-sm text-[#e5e7eb]">{{ item.content }}</div>
        <div *ngIf="showCategories && item.category" class="mt-1 text-xs text-[#6b7280]">
          {{ item.category }}
        </div>
      </div>

      <!-- Status Icons -->
      <div *ngIf="state() === 'completed'" class="flex items-center gap-1">
        <ng-icon
          *ngIf="isItemCorrect(item, index)"
          name="lucideCircleCheck"
          class="h-5 w-5 text-emerald-500"
        ></ng-icon>
        <ng-icon
          *ngIf="isItemIncorrect(item, index)"
          name="lucideCircleX"
          class="h-5 w-5 text-red-500"
        ></ng-icon>
      </div>

      <!-- Move Buttons -->
      <div *ngIf="mode === 'buttons' && state() !== 'completed'" class="flex flex-col gap-1">
        <button
          (click)="handleMoveUp(index)"
          [disabled]="index === 0"
          class="rounded border border-[#1f2937] p-1 text-[#6b7280] hover:border-[#60a5fa] hover:text-[#60a5fa] disabled:opacity-50 disabled:cursor-not-allowed"
          aria-label="Move up"
        >
          <ng-icon name="lucideArrowUp" class="h-3 w-3"></ng-icon>
        </button>
        <button
          (click)="handleMoveDown(index)"
          [disabled]="index === orderedItems().length - 1"
          class="rounded border border-[#1f2937] p-1 text-[#6b7280] hover:border-[#60a5fa] hover:text-[#60a5fa] disabled:opacity-50 disabled:cursor-not-allowed"
          aria-label="Move down"
        >
          <ng-icon name="lucideArrowDown" class="h-3 w-3"></ng-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Completion Feedback -->
  <div *ngIf="state() === 'completed' && showHints" class="mt-6 space-y-3">
    <h4 class="text-sm font-medium text-[#e5e7eb]">Correct Order Explanation</h4>
    <div
      *ngFor="let item of getSortedItemsByCorrectPosition()"
      class="flex items-start gap-3 rounded-lg border border-[#1f2937] bg-[#0b0f14] p-3"
    >
      <div class="flex h-6 w-6 items-center justify-center rounded-full border border-[#60a5fa] text-xs font-medium text-[#60a5fa]">
        {{ item.correctPosition }}
      </div>
      <div class="flex-1">
        <div class="text-sm text-[#e5e7eb]">{{ item.content }}</div>
        <div *ngIf="item.explanation" class="mt-1 text-xs text-[#9ca3af]">
          {{ item.explanation }}
        </div>
      </div>
    </div>
  </div>
</div>

