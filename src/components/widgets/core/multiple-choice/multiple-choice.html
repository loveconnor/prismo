<div
  role="group"
  [attr.aria-label]="a11yLabel || 'Multiple choice question: ' + question"
  [class]="getContainerClasses()"
>
  <!-- Question -->
  <div class="mb-4">
    <h3 class="text-lg font-semibold text-[#e5e7eb]">{{ question }}</h3>
    <p *ngIf="selectionMode === 'multiple'" class="mt-1 text-sm text-[#9ca3af]">
      Select all that apply
    </p>
  </div>

  <!-- Options -->
  <fieldset class="space-y-3">
    <legend class="sr-only">Answer options</legend>
    <button
      *ngFor="let option of shuffled(); let i = index"
      (click)="handleOptionSelect(option.value)"
      [disabled]="readOnly()"
      [class]="getOptionClasses(getOptionStatus(option), isSelected(option.value))"
      type="button"
    >
      <div class="flex items-start gap-3">
        <!-- Checkbox/Radio indicator -->
        <div class="mt-0.5 flex-shrink-0">
          <!-- Radio (single selection) -->
          <div 
            *ngIf="selectionMode === 'single'" 
            [class]="getIndicatorClasses(getOptionStatus(option), isSelected(option.value))"
          >
            <div 
              *ngIf="isSelected(option.value)" 
              class="h-full w-full rounded-full border-2 border-white bg-white"
            ></div>
          </div>

          <!-- Checkbox (multiple selection) -->
          <div 
            *ngIf="selectionMode === 'multiple'" 
            [class]="getIndicatorClasses(getOptionStatus(option), isSelected(option.value))"
          >
            <ng-icon 
              *ngIf="isSelected(option.value)" 
              name="lucideCircleCheck" 
              class="h-3 w-3 text-white"
            ></ng-icon>
          </div>
        </div>

        <!-- Option content -->
        <div class="flex-1">
          <div class="flex items-center gap-2">
            <span class="text-[#e5e7eb]">{{ option.label }}</span>
            <ng-icon
              *ngIf="submitted() && getOptionStatus(option) === 'correct' && emphasizeCorrect"
              name="lucideCircleCheck"
              class="h-4 w-4 text-emerald-500"
            ></ng-icon>
            <ng-icon
              *ngIf="submitted() && getOptionStatus(option) === 'incorrect' && isSelected(option.value)"
              name="lucideCircleX"
              class="h-4 w-4 text-red-500"
            ></ng-icon>
          </div>

          <!-- Rationale -->
          <p 
            *ngIf="submitted() && showRationale && option.rationale" 
            class="mt-2 text-sm text-[#9ca3af]"
          >
            {{ option.rationale }}
          </p>
        </div>
      </div>
    </button>
  </fieldset>

  <!-- Submit Button -->
  <div *ngIf="!submitted()" class="mt-6 flex justify-center">
    <button
      (click)="handleSubmit()"
      [disabled]="!isValid()"
      [class]="cn(
        'rounded-lg px-6 py-2 text-sm font-medium transition-colors',
        isValid()
          ? 'bg-[#3b82f6] text-white hover:bg-[#2563eb]'
          : 'cursor-not-allowed bg-[#1f2937] text-[#6b7280]'
      )"
      type="button"
    >
      {{ selectionMode === 'single' ? 'Submit Answer' : 'Submit Answers' }}
    </button>
  </div>

  <!-- Result -->
  <div 
    *ngIf="submitted() && correctAnswers.length > 0" 
    class="mt-4 rounded-lg border border-[#1f2937] bg-[#0b0f14] p-4"
  >
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-2">
        <ng-container *ngIf="isCorrect()">
          <ng-icon name="lucideCircleCheck" class="h-5 w-5 text-emerald-500"></ng-icon>
          <span class="font-medium text-emerald-500">Correct!</span>
        </ng-container>
        <ng-container *ngIf="!isCorrect()">
          <ng-icon name="lucideCircleX" class="h-5 w-5 text-red-500"></ng-icon>
          <div>
            <span class="font-medium text-red-500">Incorrect</span>
            <p *ngIf="attempts() < maxAttempts" class="text-sm text-[#9ca3af] mt-1">
              Try again! (Attempt {{ attempts() }} of {{ maxAttempts }})
            </p>
            <p *ngIf="attempts() >= maxAttempts" class="text-sm text-[#9ca3af] mt-1">
              No more attempts remaining.
            </p>
          </div>
        </ng-container>
      </div>
    </div>
  </div>
</div>

