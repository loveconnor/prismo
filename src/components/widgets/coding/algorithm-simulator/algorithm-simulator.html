<div class="bg-card rounded-lg shadow-sm border border-border w-full">
  <!-- Header -->
  <div class="border-b border-border p-4">
    <div class="flex items-center justify-between mb-4">
      <h2 class="text-xl font-semibold text-foreground">Algorithm Simulator</h2>
      <div class="flex gap-2">
        <button type="button" (click)="togglePlay()" class="p-2 rounded-lg bg-primary text-primary-foreground hover:bg-primary/90 transition-colors">
          <ng-icon [name]="isPlaying() ? 'lucidePause' : 'lucidePlay'" class="h-5 w-5"></ng-icon>
        </button>
        <button type="button" (click)="handleReset()" class="p-2 rounded-lg bg-muted text-foreground hover:bg-accent transition-colors">
          <ng-icon name="lucideRotateCcw" class="h-5 w-5"></ng-icon>
        </button>
      </div>
    </div>

    <!-- Algorithm Selection -->
    <div class="flex gap-2 mb-4">
      <button type="button" (click)="setAlgorithm('bubble')" [class]="algorithm() === 'bubble' ? 'px-4 py-2 rounded-lg font-medium bg-primary text-primary-foreground' : 'px-4 py-2 rounded-lg font-medium bg-accent text-foreground hover:bg-accent/70'">Bubble Sort</button>
      <button type="button" (click)="setAlgorithm('quick')" [class]="algorithm() === 'quick' ? 'px-4 py-2 rounded-lg font-medium bg-primary text-primary-foreground' : 'px-4 py-2 rounded-lg font-medium bg-accent text-foreground hover:bg-accent/70'">Quick Sort</button>
      <button type="button" (click)="setAlgorithm('recursion')" [class]="algorithm() === 'recursion' ? 'px-4 py-2 rounded-lg font-medium bg-primary text-primary-foreground' : 'px-4 py-2 rounded-lg font-medium bg-accent text-foreground hover:bg-accent/70'">Recursion Tree</button>
    </div>

    <!-- Controls -->
    <div class="grid grid-cols-2 gap-4">
      <div>
        <label class="block text-sm font-medium text-foreground mb-1">Speed: {{ speed() }}ms</label>
        <input type="range" min="100" max="2000" step="100" [value]="speed()" (input)="onSpeedChange($any($event.target).valueAsNumber)" class="w-full" />
      </div>
      <div *ngIf="algorithm() !== 'recursion'">
        <label class="block text-sm font-medium text-foreground mb-1">Array Size: {{ arraySize() }}</label>
        <input type="range" min="5" max="20" [value]="arraySize()" (input)="onArraySizeChange($any($event.target).valueAsNumber)" class="w-full" />
      </div>
    </div>
  </div>

  <!-- Visualization Area -->
  <div class="p-6 min-h-[400px]">
    <!-- Bubble Sort -->
    <div *ngIf="algorithm() === 'bubble'" class="space-y-4">
      <div class="flex items-end justify-center gap-1 h-64">
        <div *ngFor="let value of bubbleArray(); let idx = index"
             [class]="(bubbleSorted().includes(idx) ? 'flex-1 rounded-t-lg bg-green-500 transition-colors' : (bubbleComparing().includes(idx) ? 'flex-1 rounded-t-lg bg-red-500 transition-colors' : 'flex-1 rounded-t-lg bg-blue-500 transition-colors'))"
             [style.height.%]="(value / bubbleMax) * 100">
          <span class="text-xs text-white text-center block mt-1">{{ value }}</span>
        </div>
      </div>
      <div class="text-center text-sm text-muted-foreground">
        <p><span class="font-medium">Step:</span> {{ bubbleStep() }}</p>
        <p class="mt-1">
          <span class="inline-block w-4 h-4 bg-red-500 rounded mr-2"></span>Comparing
          <span class="inline-block w-4 h-4 bg-green-500 rounded mx-2 ml-4"></span>Sorted
        </p>
      </div>
    </div>

    <!-- Quick Sort -->
    <div *ngIf="algorithm() === 'quick'" class="space-y-4">
      <div class="flex items-end justify-center gap-1 h-64">
        <div *ngFor="let value of quickCurrent.array; let idx = index"
             [class]="(idx === quickCurrent.pivot ? 'flex-1 rounded-t-lg bg-purple-500 transition-colors' : (idx === quickCurrent.left ? 'flex-1 rounded-t-lg bg-red-500 transition-colors' : (idx === quickCurrent.right ? 'flex-1 rounded-t-lg bg-orange-500 transition-colors' : 'flex-1 rounded-t-lg bg-blue-500 transition-colors')))"
             [style.height.%]="(value / quickMax) * 100">
          <span class="text-xs text-white text-center block mt-1">{{ value }}</span>
        </div>
      </div>
      <div class="text-center text-sm text-muted-foreground">
        <p><span class="font-medium">Step:</span> {{ quickStepIdx() }} / {{ quickSteps().length }}</p>
        <p class="mt-1">
          <span class="inline-block w-4 h-4 bg-purple-500 rounded mr-2"></span>Pivot
          <span class="inline-block w-4 h-4 bg-red-500 rounded mx-2 ml-4"></span>Scanning
          <span class="inline-block w-4 h-4 bg-orange-500 rounded mx-2 ml-4"></span>Partition
        </p>
      </div>
    </div>

    <!-- Recursion Tree -->
    <div *ngIf="algorithm() === 'recursion'" class="space-y-4">
      <div class="flex items-center justify-center gap-4">
        <label class="text-sm font-medium text-foreground">Fibonacci(n):</label>
        <input type="number" min="1" max="7" [value]="fibN()" (input)="onFibNChange($any($event.target).valueAsNumber)" class="px-3 py-1 border border-border bg-background text-foreground rounded-lg w-20" />
      </div>
      <div class="overflow-x-auto">
        <svg width="100%" height="400" class="mx-auto">
          <g *ngFor="let e of edges()">
            <line [attr.x1]="e.x1" [attr.y1]="e.y1" [attr.x2]="e.x2" [attr.y2]="e.y2" [attr.stroke]="'var(--border)'" stroke-width="2" />
          </g>
          <g *ngFor="let n of nodes()">
            <circle [attr.cx]="n.x" [attr.cy]="n.y" r="20" [attr.fill]="activePath() === n.path ? '#EF4444' : '#3B82F6'" stroke="#1E40AF" stroke-width="2" />
            <text [attr.x]="n.x" [attr.y]="n.y" text-anchor="middle" dy=".3em" fill="white" font-size="14" font-weight="bold">{{ n.value }}</text>
          </g>
        </svg>
      </div>
      <div class="text-center text-sm text-muted-foreground">
        <p>Visualizing Fibonacci recursion tree for F({{ fibN() }})</p>
        <p class="mt-1">
          <span class="inline-block w-4 h-4 bg-red-500 rounded mr-2"></span>Currently Computing
        </p>
      </div>
    </div>
  </div>
</div>


