<div
  role="group"
  [attr.aria-label]="a11yLabel || ('Complexity analysis question: ' + question)"
  [class]="getRootClasses()"
>
  <!-- Header -->
  <div class="flex items-center gap-3 border-b border-[#1f2937] p-4">
    <ng-icon name="lucideTrendingUp" class="h-6 w-6 text-[#60a5fa]"></ng-icon>
    <div>
      <h3 class="text-lg font-semibold text-[#e5e7eb]">Complexity Analysis</h3>
      <p class="text-sm text-[#a9b1bb] capitalize">{{ category }} Complexity</p>
    </div>
  </div>

  <!-- Question -->
  <div class="p-4">
    <h4 class="mb-4 text-base font-medium text-[#e5e7eb]">{{ question }}</h4>

    <!-- Code Snippet -->
    <div *ngIf="codeSnippet" class="mb-4 rounded-lg border border-[#1f2937] bg-[#0b0f14] p-3">
      <div class="mb-2 text-xs font-medium text-[#a9b1bb] uppercase">{{ language }}</div>
      <pre class="overflow-x-auto text-sm text-[#e5e7eb]"><code>{{ codeSnippet }}</code></pre>
    </div>

    <!-- Interactive Complexity Graph -->
    <div *ngIf="showGraph" class="mb-6">
      <h5 class="text-sm font-medium text-[#e5e7eb] mb-3">Visualize Complexity Growth:</h5>
      <div class="rounded-lg border border-[#1f2937] bg-[#0a0e12] p-4">
        <app-complexity-graph
          class="h-80 block"
          [selectedComplexity]="selectedAnswer() ? levelToComplexityType(selectedAnswer()!) : null"
          [showLegend]="true"
          [interactive]="true"
          (selectComplexity)="onGraphSelect($event)"
        ></app-complexity-graph>
      </div>
    </div>

    <!-- Complexity Options -->
    <div class="mb-4 grid gap-3 md:grid-cols-2">
      <button
        *ngFor="let option of complexityOptions"
        type="button"
        (click)="handleAnswerSelect(option.level)"
        [disabled]="showFeedback && !allowMultipleAttempts"
        [class]="getOptionClasses(option.level)"
      >
        <div class="flex items-start justify-between">
          <div class="flex-1">
            <div class="flex items-center gap-2 mb-1">
              <span class="font-medium text-[#e5e7eb]">{{ option.name }}</span>
              <span class="rounded bg-[#0a0e12] px-2 py-0.5 text-xs font-mono text-[#60a5fa]">{{ option.bigO }}</span>
            </div>
            <p class="text-sm text-[#a9b1bb]">{{ option.description }}</p>

            <div *ngIf="showExamples" class="mt-2">
              <div class="text-xs text-[#6b7280] mb-1">Examples:</div>
              <div class="flex flex-wrap gap-1">
                <span *ngFor="let ex of option.examples | slice:0:2; let i = index" class="rounded bg-[#0a0e12] px-2 py-0.5 text-xs text-[#a9b1bb]">{{ ex }}</span>
              </div>
            </div>
          </div>

          <ng-icon *ngIf="showFeedback && selectedAnswer() !== null && option.level === correctAnswer" name="lucideCircleCheck" class="h-5 w-5 text-emerald-500 flex-shrink-0"></ng-icon>
          <ng-icon *ngIf="showFeedback && selectedAnswer() === option.level && selectedAnswer() !== correctAnswer" name="lucideCircleX" class="h-5 w-5 text-red-500 flex-shrink-0"></ng-icon>
        </div>
      </button>
    </div>

    <!-- Hint Button -->
    <div *ngIf="showHints" class="mb-4">
      <button
        type="button"
        (click)="handleHintToggle()"
        class="inline-flex items-center gap-2 rounded-lg border border-[#1f2937] bg-[#0b0f14] px-3 py-2 text-sm text-[#a9b1bb] hover:bg-[#0e1318] transition-colors"
      >
        <ng-icon name="lucideCircleHelp" class="h-4 w-4"></ng-icon>
        {{ showHint() ? 'Hide Hint' : 'Show Hint' }}
      </button>

      <div *ngIf="showHint()" class="mt-2 rounded-lg border border-blue-500/20 bg-blue-500/10 p-3">
        <h5 class="text-sm font-medium text-blue-400 mb-2">Hint:</h5>
        <ul class="text-sm text-[#a9b1bb] space-y-1">
          <li>â€¢ Look at how many times the main operations repeat</li>
          <li>â€¢ Consider the worst-case scenario for input size n</li>
          <li>â€¢ Nested loops multiply complexities</li>
          <li>â€¢ Simple operations like array access are O(1)</li>
        </ul>
      </div>
    </div>

    <!-- Feedback -->
    <div *ngIf="showFeedback && selectedAnswer()" [class]="cn('rounded-lg p-3', isCorrect() ? 'border border-emerald-500/20 bg-emerald-500/10' : 'border border-red-500/20 bg-red-500/10')">
      <div class="flex items-start gap-3">
        <ng-icon *ngIf="isCorrect(); else incorrectIcon" name="lucideCircleCheck" class="h-5 w-5 text-emerald-500 flex-shrink-0 mt-0.5"></ng-icon>
        <ng-template #incorrectIcon>
          <ng-icon name="lucideCircleX" class="h-5 w-5 text-red-500 flex-shrink-0 mt-0.5"></ng-icon>
        </ng-template>
        <div>
          <h5 [class]="cn('font-medium', isCorrect() ? 'text-emerald-500' : 'text-red-500')">
            {{ isCorrect() ? 'Correct!' : 'Not quite right' }}
          </h5>

          <p *ngIf="!isCorrect() && showCorrectAnswer && correctOption" class="mt-1 text-sm text-[#a9b1bb]">
            The correct answer is
            <strong>{{ correctOption.name }}</strong>
            ({{ correctOption.bigO }}).
          </p>

          <div *ngIf="selectedAnswer() && !isCorrect() && selectedOption" class="mt-2">
            <p class="text-sm text-[#a9b1bb]">
              You selected
              <strong>{{ selectedOption.name }}</strong>.
              <span *ngIf="selectedMistake" class="block mt-1 text-xs text-red-300">
                Common mistake: {{ selectedMistake }}
              </span>
            </p>
          </div>
        </div>
      </div>
    </div>

    <!-- Performance Tips -->
    <div class="mt-4 rounded-lg border border-[#1f2937] bg-[#0b0f14] p-3">
      <h5 class="text-sm font-medium text-[#e5e7eb] mb-2 flex items-center gap-2">
        <ng-icon name="lucideZap" class="h-4 w-4 text-[#60a5fa]"></ng-icon>
        Performance Guidelines
      </h5>
      <div class="grid gap-2 text-sm text-[#a9b1bb] md:grid-cols-2">
        <div><span class="text-emerald-500">âœ“ Good:</span> O(1), O(log n), O(n)</div>
        <div><span class="text-amber-500">âš  Careful:</span> O(n log n), O(nÂ²)</div>
        <div><span class="text-red-500">âœ— Avoid:</span> O(2^n), O(n!)</div>
        <div><span class="text-blue-500">ðŸ’¡ Optimize:</span> Look for algorithmic improvements</div>
      </div>
    </div>
  </div>

  <!-- Footer -->
  <div class="flex items-center justify-between border-t border-[#1f2937] p-4">
    <div class="text-sm text-[#6b7280]">
      <ng-container *ngIf="attempts() > 0">Attempts: {{ attempts() }}</ng-container>
    </div>

    <div class="flex items-center gap-2 text-sm text-[#6b7280]">
      <ng-icon name="lucideClock" class="h-4 w-4"></ng-icon>
      <span>Analyze the algorithm's scaling behavior</span>
    </div>
  </div>
</div>


