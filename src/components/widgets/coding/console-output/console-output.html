<div
  role="log"
  [attr.aria-label]="a11yLabel || ('Console output: ' + title)"
  aria-live="polite"
  aria-atomic="false"
  class="mx-auto w-full max-w-4xl rounded-2xl shadow-sm"
  [ngClass]="{
    'max-w-2xl': variant === 'compact',
    'rounded-lg border-0 shadow-none': variant === 'embedded',
    'border-[#1f2937] bg-[#0a0e12] border': theme === 'dark',
    'border-gray-200 bg-white border': theme === 'light'
  }"
>
  <!-- Header -->
  <div class="flex items-center justify-between p-4" [ngClass]="theme === 'dark' ? 'border-b border-[#1f2937] bg-[#0e1318]' : 'border-b border-gray-200 bg-gray-50'">
    <div class="flex items-center gap-3">
      <div class="flex items-center gap-2">
        <div *ngIf="isRunning; else idleIcon" class="h-4 w-4 animate-spin rounded-full border-2 border-[#60a5fa] border-t-transparent"></div>
        <ng-template #idleIcon>
          <ng-icon name="lucideTerminal" class="h-5 w-5 text-[#60a5fa]"></ng-icon>
        </ng-template>
        <h3 class="text-lg font-semibold text-[#e5e7eb]">{{ title }}</h3>
      </div>

      <span *ngIf="isRunning" class="rounded-full border border-blue-500/20 bg-blue-500/10 px-2 py-0.5 text-xs text-blue-500">
        Running...
      </span>
    </div>

    <div class="flex items-center gap-2">
      <button *ngIf="allowCopy && lines.length > 0"
              (click)="handleCopy()"
              class="inline-flex items-center gap-2 rounded-lg px-3 py-2 text-sm transition-colors"
              [ngClass]="theme === 'dark' ? 'border border-[#1f2937] bg-[#0b0f14] text-[#a9b1bb] hover:bg-[#0e1318] hover:text-[#e5e7eb]' : 'border border-gray-200 bg-white text-gray-700 hover:bg-gray-100 hover:text-gray-900'"
              title="Copy output">
        <ng-icon name="lucideCopy" class="h-4 w-4"></ng-icon>
      </button>

      <button *ngIf="allowDownload && lines.length > 0"
              (click)="handleDownload()"
              class="inline-flex items-center gap-2 rounded-lg px-3 py-2 text-sm transition-colors"
              [ngClass]="theme === 'dark' ? 'border border-[#1f2937] bg-[#0b0f14] text-[#a9b1bb] hover:bg-[#0e1318] hover:text-[#e5e7eb]' : 'border border-gray-200 bg-white text-gray-700 hover:bg-gray-100 hover:text-gray-900'"
              title="Download output">
        <ng-icon name="lucideDownload" class="h-4 w-4"></ng-icon>
      </button>

      <button *ngIf="allowClear && lines.length > 0"
              (click)="handleClear()"
              class="inline-flex items-center gap-2 rounded-lg px-3 py-2 text-sm transition-colors"
              [ngClass]="theme === 'dark' ? 'border border-[#1f2937] bg-[#0b0f14] text-[#a9b1bb] hover:bg-[#0e1318] hover:text-[#e5e7eb]' : 'border border-gray-200 bg-white text-gray-700 hover:bg-gray-100 hover:text-gray-900'"
              title="Clear console">
        <ng-icon name="lucideRotateCcw" class="h-4 w-4"></ng-icon>
      </button>
    </div>
  </div>

  <!-- Console Content -->
  <div
    class="overflow-auto p-4 font-mono text-sm"
    [ngClass]="theme === 'dark' ? 'bg-[#0a0e12]' : 'bg-white'"
    [ngClass]="{
      'max-h-[200px]': height === 'sm',
      'max-h-[400px]': height === 'md',
      'max-h-[600px]': height === 'lg',
      'max-h-none': height === 'auto',
      'whitespace-pre-wrap break-words': wordWrap,
      'whitespace-pre': !wordWrap
    }"
    [ngStyle]="consoleContainerStyles"
  >
    <div *ngIf="displayLines.length === 0" class="text-center py-8" [ngClass]="theme === 'dark' ? 'text-[#6b7280]' : 'text-gray-500'">
      <ng-icon name="lucideTerminal" class="h-12 w-12 mx-auto mb-4 opacity-50"></ng-icon>
      <p>No output yet. Run your code to see results here.</p>
    </div>

    <div *ngFor="let line of displayLines" class="flex items-start gap-2 py-0.5" [ngClass]="getLineColor(line.type)">
      <span *ngIf="showTimestamps" class="flex-shrink-0 text-xs" [ngClass]="theme === 'dark' ? 'text-[#6b7280]' : 'text-gray-500'">
        {{ formatTimestamp(line.timestamp) }}
      </span>
      <span class="flex-shrink-0 text-xs">{{ getLineIcon(line.type) }}</span>
      <span class="flex-1 leading-relaxed">{{ line.content }}</span>
    </div>

    <!-- Auto-scroll anchor -->
    <div #endRef></div>
  </div>

  <!-- Footer -->
  <div class="flex items-center justify-between p-4" [ngClass]="theme === 'dark' ? 'border-t border-[#1f2937] bg-[#0e1318]' : 'border-t border-gray-200 bg-gray-50'">
    <div class="text-sm" [ngClass]="theme === 'dark' ? 'text-[#6b7280]' : 'text-gray-500'">
      {{ displayLines.length }} {{ displayLines.length === 1 ? 'line' : 'lines' }}
      <ng-container *ngIf="lines.length > maxLines">(showing last {{ maxLines }})</ng-container>
    </div>

    <div class="flex items-center gap-4 text-sm" [ngClass]="theme === 'dark' ? 'text-[#6b7280]' : 'text-gray-500'">
      <span *ngIf="autoScroll" class="flex items-center gap-1">
        <span class="h-2 w-2 rounded-full bg-emerald-500"></span>
        Auto-scroll
      </span>
      <span *ngIf="wordWrap">Word wrap</span>
    </div>
  </div>
</div>


